<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
layout:decorate="~{layout/layoutCajero}">

<head>
    <meta charset="UTF-8">
    <title>Buscar Citas Médicas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
	
</head>

<body >
	

	
<div layout:fragment="content" class="container mt-4">
	
	<div th:if="${mensaje}" class="alert alert-success">
	    <p th:text="${mensaje}"></p>
	</div>
	
	    <h2 class="mb-4">Buscar Citas Médicas</h2>
	
	    <!-- Formulario de búsqueda -->
	    <form class="row g-3 mb-4" id="formBusqueda">
	        <div class="col-md-3">
	            <label for="tipo" class="form-label">Buscar por:</label>
	            <select class="form-select" id="tipo" name="tipo">
	                <option value="medico">Por ID Médico</option>
	                <option value="paciente">Por ID Paciente</option>
	                <option value="estado">Por Estado de Cita</option>
	            </select>
	        </div>
	
	        <div class="col-md-4">
	            <label for="valor" class="form-label">Valor:</label>
	            <input type="text" class="form-control form-control-sm" id="valor" name="valor" placeholder="Ingrese valor de búsqueda">
	        </div>
	
	        <div class="col-md-4 mt-4 d-flex align-items-center gap-2">
	            <button type="submit" class="btn btn-primary btn-sm">Buscar</button>
	            <a th:href="@{/cajero/citas/listar}" class="btn btn-outline-secondary btn-sm">Mostrar todas las Citas</a>
	        </div>
	    </form>
	
		</br>
		
	    <!-- Tabla de resultados -->
	    <table class="table table-bordered table-striped">
	        <thead>
	            <tr class="table-dark">
	                <th >Nro Cita</th>
	                <th>ID Paciente</th>
	                <th>ID Médico</th>
	                <th>Fecha de Cita</th>
	                <th>Hora</th>
	                <th>Estado Cita</th>
	                <th>Acciones</th>
	            </tr>
	        </thead>
	        <tbody>
	            <tr th:each="cita : ${citas}">
	                <td th:text="${cita.nroCita}"></td>
	                <td th:text="${cita.paciente.idPaciente}"></td>
	                <td th:text="${cita.medico.idMedico}"></td>
	                <td th:text="${#dates.format(cita.fechaCita, 'yyyy-MM-dd')}"></td>
	                <td th:text="${cita.horaCita}"></td>
	                <td th:text="${cita.estado}"></td>
	                <td>
	                    <div class="d-flex justify-content-center gap-2">
	                        <a th:href="@{/cajero/citas/detalle/{id}(id=${cita.nroCita})}" class="btn btn-outline-secondary btn-sm" title="Ver Detalle">
	                            <i class="bi bi-eye"></i>
	                        </a>
	                        <a th:href="@{/cajero/citas/editar/{id}(id=${cita.nroCita})}" class="btn btn-outline-primary btn-sm" title="Editar Estado Cita">
	                            <i class="bi bi-pencil"></i>
	                        </a>
							
							<!-- Generar Comprobante de Pago -->
							<a th:href="@{/cajero/citas/generarCDP(nroCita=${cita.nroCita})}" 
							   class="btn btn-outline-success btn-sm" title="Generar CDP">
							   <i class="bi bi-file-earmark-plus"></i>
							</a>

							
	                    </div>
					</td>
				</tr>
			</tbody>
		</table>
		
		<!-- Botón de regresar -->
		<div class="d-flex justify-content-end mt-3">
		    <a th:href="@{/dashboard/cajero}" class="btn btn-secondary btn-sm">
		        <i class="bi bi-arrow-left"></i> Regresar
		    </a>
		</div>
		</br>
		</br>
		
	
		<script>
			 document.getElementById("formBusqueda").addEventListener("submit", function(event) {
				event.preventDefault();
	
			const tipo = document.getElementById("tipo").value;
			const valor = document.getElementById("valor").value.trim();
	
			if (!valor) {
				alert("Ingrese un valor de búsqueda.");
				return;
			}
	
			let parametro = "";
			if (tipo === "estado") parametro = "estado";
			else if (tipo === "medico") parametro = "idMedico";
			else parametro = "idPaciente";
	
			const url = `/cajero/citas/buscar/${tipo}?${parametro}=${valor.toLowerCase()}`;
			window.location.href = url;
			});
		</script>
		
		<script th:inline="javascript">
		    /* Manejo seguro en caso no venga el atributo mensajeError */
		    /* Usamos 'null' como valor por defecto si no existe */
		    let mensajeError = /*[[${mensajeError}]]*/ null;
		    if (mensajeError !== null && mensajeError !== '') {
		        alert(mensajeError);
		    }
		</script>
		
		<script>
		    setTimeout(function () {
		        const alerta = document.querySelector('.alert-success');
		        if (alerta) alerta.style.display = 'none';
		    }, 3000);
		</script>
		
</div>
</body>
</html>				
